# Generated Berry code from Animation DSL
# Source: test_complex_template.anim
# 
# This file was automatically generated by compile_all_examples.sh
# Do not edit manually - changes will be overwritten

import animation

# Complex template test
# Template animation class: rainbow_pulse
class rainbow_pulse_animation : animation.engine_proxy
  static var PARAMS = animation.enc_params({
    "pal1": {"type": "palette"},
    "pal2": {"type": "palette"},
    "period": {"type": "time"},
    "back_color": {"type": "color"}
  })

  # Template setup method - overrides EngineProxy placeholder
  def setup_template()
    var engine = self   # using 'self' as a proxy to engine object (instead of 'self.engine')

    var cycle_color_ = animation.color_cycle(engine)
    cycle_color_.palette = animation.create_closure_value(engine, def (engine) return self.pal1 end)
    cycle_color_.cycle_period = animation.create_closure_value(engine, def (engine) return self.period end)
    # Create pulsing animation
    var pulse_ = animation.pulsating_animation(engine)
    pulse_.color = cycle_color_
    pulse_.period = animation.create_closure_value(engine, def (engine) return self.period end)
    # Create background
    var background_ = animation.solid(engine)
    background_.color = animation.create_closure_value(engine, def (engine) return self.back_color end)
    background_.priority = 1
    # Set pulse priority higher
    pulse_.priority = 10
    # Run both animations
    self.add(background_)
    self.add(pulse_)
  end
end

# Create palettes
# Auto-generated strip initialization (using Tasmota configuration)
var engine = animation.init_strip()

var fire_palette_ = bytes("00000000" "80FF0000" "FFFFFF00")
var ocean_palette_ = bytes("00000080" "800080FF" "FF00FFFF")
# Use the template
var main_ = rainbow_pulse_animation(engine)
main_.pal1 = fire_palette_
main_.pal2 = ocean_palette_
main_.perriod = 3000
main_.back_color = 0xFF001100
engine.add(main_)
engine.run()

# Compilation warnings:
# Line 28: Template 'rainbow_pulse' parameter 'pal2' is declared but never used in the template body.


#- Original DSL source:
# Complex template test

template animation rainbow_pulse {
  param pal1 type palette
  param pal2 type palette
  param period type time
  param back_color type color
  
  # Create color cycle using first palette
  color cycle_color = color_cycle(palette=pal1, cycle_period=period)
  
  # Create pulsing animation
  animation pulse = pulsating_animation(
    color=cycle_color
    period=period
  )
  
  # Create background
  animation background = solid(color=back_color)
  background.priority = 1
  
  # Set pulse priority higher
  pulse.priority = 10
  
  # Run both animations
  run background
  run pulse
}

# Create palettes
palette fire_palette = [
  (0, 0x000000)
  (128, 0xFF0000)
  (255, 0xFFFF00)
]

palette ocean_palette = [
  (0, 0x000080)
  (128, 0x0080FF)
  (255, 0x00FFFF)
]

# Use the template
animation main = rainbow_pulse(pal1 = fire_palette, pal2 = ocean_palette, perriod = 3s, back_color = 0x001100)
run main

-#

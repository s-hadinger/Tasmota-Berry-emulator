# @desc VU-meter with random level using custom Berry function

# Embed native Berry code to define a random generator function
berry """
# define a pseudo-random generator, returns value in range 0..255
def rand_meter(engine)
  return (engine.time_ms * 2654435761) & 0xFF
end
"""

# Declare the external function so it can be used in the animation
extern function rand_meter

# Define a palette of rainbow colors including white with constant brightness
palette vue_meter_palette = [
  (  0, 0x00FF00)     # Green
  (143, 0x00FF00)

  (164, 0xFFFF00)     # Yellow
  (207, 0xFFFF00)

  (228, 0xFF0000)     # Red
  (255, 0xFF0000)
]

# Define a color palette pattern for 'vue_meter_palette'
color rainbow_rich_color = rich_palette(colors=vue_meter_palette, period=0, transition_type=LINEAR)

# Define a vue-meter based on all elements above
animation back = palette_meter_animation(color_source = rainbow_rich_color, level = rand_meter())
run back